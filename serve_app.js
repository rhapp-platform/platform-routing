var W$=($,O)=>{try{return O($)}catch{return $.replace(/(?:%[0-9A-Fa-f]{2})+/g,(Y)=>{try{return O(Y)}catch{return Y}})}};var g=($)=>{if(!/[%+]/.test($))return $;if($.indexOf("+")!==-1)$=$.replace(/\+/g," ");return $.indexOf("%")!==-1?T($):$},L$=($,O,Y)=>{let Z;if(!Y&&O&&!/[%+]/.test(O)){let G=$.indexOf(`?${O}`,8);if(G===-1)G=$.indexOf(`&${O}`,8);while(G!==-1){const W=$.charCodeAt(G+O.length+1);if(W===61){const L=G+O.length+2,z=$.indexOf("&",L);return g($.slice(L,z===-1?void 0:z))}else if(W==38||isNaN(W))return"";G=$.indexOf(`&${O}`,G+1)}if(Z=/[%+]/.test($),!Z)return}const X={};Z??=/[%+]/.test($);let M=$.indexOf("?",8);while(M!==-1){const G=$.indexOf("&",M+1);let W=$.indexOf("=",M);if(W>G&&G!==-1)W=-1;let L=$.slice(M+1,W===-1?G===-1?void 0:G:W);if(Z)L=g(L);if(M=G,L==="")continue;let z;if(W===-1)z="";else if(z=$.slice(W+1,G===-1?void 0:G),Z)z=g(z);if(Y){if(!(X[L]&&Array.isArray(X[L])))X[L]=[];X[L].push(z)}else X[L]??=z}return O?X[O]:X},z$=L$,V$=($,O)=>{return L$($,O,!0)},T=decodeURIComponent;var c=($)=>{return y($.replace(/_|-/g,(O)=>({_:"/","-":"+"})[O]??O))},k=($)=>y$($).replace(/\/|\+/g,(O)=>({"/":"_","+":"-"})[O]??O),y$=($)=>{let O="";const Y=new Uint8Array($);for(let Z=0,X=Y.length;Z<X;Z++)O+=String.fromCharCode(Y[Z]);return btoa(O)},y=($)=>{const O=atob($),Y=new Uint8Array(new ArrayBuffer(O.length)),Z=O.length/2;for(let X=0,M=O.length-1;X<=Z;X++,M--)Y[X]=O.charCodeAt(X),Y[M]=O.charCodeAt(M);return Y};var d=(($)=>{return $.HS256="HS256",$.HS384="HS384",$.HS512="HS512",$.RS256="RS256",$.RS384="RS384",$.RS512="RS512",$.PS256="PS256",$.PS384="PS384",$.PS512="PS512",$.ES256="ES256",$.ES384="ES384",$.ES512="ES512",$.EdDSA="EdDSA",$})(d||{});var d$={deno:"Deno",bun:"Bun",workerd:"Cloudflare-Workers",node:"Node.js"},N$=()=>{const $=globalThis;if(typeof navigator!=="undefined"&&typeof navigator.userAgent==="string"){for(let[Y,Z]of Object.entries(d$))if(u$(Z))return Y}if(typeof $?.EdgeRuntime==="string")return"edge-light";if($?.fastly!==void 0)return"fastly";if($?.process?.release?.name==="node")return"node";return"other"},u$=($)=>{return navigator.userAgent.startsWith($)};var D$=class extends Error{constructor($){super(`${$} is not an implemented algorithm`);this.name="JwtAlgorithmNotImplemented"}},u=class extends Error{constructor($){super(`invalid JWT token: ${$}`);this.name="JwtTokenInvalid"}},F$=class extends Error{constructor($){super(`token (${$}) is being used before it's valid`);this.name="JwtTokenNotBefore"}},J$=class extends Error{constructor($){super(`token (${$}) expired`);this.name="JwtTokenExpired"}},E$=class extends Error{constructor($,O){super(`Incorrect "iat" claim must be a older than "${$}" (iat: "${O}")`);this.name="JwtTokenIssuedAt"}},_$=class extends Error{constructor($){super(`jwt header is invalid: ${JSON.stringify($)}`);this.name="JwtHeaderInvalid"}},B$=class extends Error{constructor($){super(`token(${$}) signature mismatched`);this.name="JwtTokenSignatureMismatched"}},I=(($)=>{return $.Encrypt="encrypt",$.Decrypt="decrypt",$.Sign="sign",$.Verify="verify",$.DeriveKey="deriveKey",$.DeriveBits="deriveBits",$.WrapKey="wrapKey",$.UnwrapKey="unwrapKey",$})(I||{});var j=new TextEncoder,j$=new TextDecoder;async function A$($,O,Y){const Z=I$(O),X=await i$($,Z);return await crypto.subtle.sign(Z,X,Y)}async function H$($,O,Y,Z){const X=I$(O),M=await p$($,X);return await crypto.subtle.verify(X,M,Y,Z)}var i=function($){return y($.replace(/-+(BEGIN|END).*/g,"").replace(/\s/g,""))};async function i$($,O){if(!crypto.subtle||!crypto.subtle.importKey)throw new Error("`crypto.subtle.importKey` is undefined. JWT auth middleware requires it.");if(S$($)){if($.type!=="private"&&$.type!=="secret")throw new Error(`unexpected key type: CryptoKey.type is ${$.type}, expected private or secret`);return $}const Y=[I.Sign];if(typeof $==="object")return await crypto.subtle.importKey("jwk",$,O,!1,Y);if($.includes("PRIVATE"))return await crypto.subtle.importKey("pkcs8",i($),O,!1,Y);return await crypto.subtle.importKey("raw",j.encode($),O,!1,Y)}async function p$($,O){if(!crypto.subtle||!crypto.subtle.importKey)throw new Error("`crypto.subtle.importKey` is undefined. JWT auth middleware requires it.");if(S$($)){if($.type==="public"||$.type==="secret")return $;$=await U$($)}if(typeof $==="string"&&$.includes("PRIVATE")){const Z=await crypto.subtle.importKey("pkcs8",i($),O,!0,[I.Sign]);$=await U$(Z)}const Y=[I.Verify];if(typeof $==="object")return await crypto.subtle.importKey("jwk",$,O,!1,Y);if($.includes("PUBLIC"))return await crypto.subtle.importKey("spki",i($),O,!1,Y);return await crypto.subtle.importKey("raw",j.encode($),O,!1,Y)}async function U$($){if($.type!=="private")throw new Error(`unexpected key type: ${$.type}`);if(!$.extractable)throw new Error("unexpected private key is unextractable");const O=await crypto.subtle.exportKey("jwk",$),{kty:Y}=O,{alg:Z,e:X,n:M}=O,{crv:G,x:W,y:L}=O;return{kty:Y,alg:Z,e:X,n:M,crv:G,x:W,y:L,key_ops:[I.Verify]}}var I$=function($){switch($){case"HS256":return{name:"HMAC",hash:{name:"SHA-256"}};case"HS384":return{name:"HMAC",hash:{name:"SHA-384"}};case"HS512":return{name:"HMAC",hash:{name:"SHA-512"}};case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"RS384":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case"RS512":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case"PS256":return{name:"RSA-PSS",hash:{name:"SHA-256"},saltLength:32};case"PS384":return{name:"RSA-PSS",hash:{name:"SHA-384"},saltLength:48};case"PS512":return{name:"RSA-PSS",hash:{name:"SHA-512"},saltLength:64};case"ES256":return{name:"ECDSA",hash:{name:"SHA-256"},namedCurve:"P-256"};case"ES384":return{name:"ECDSA",hash:{name:"SHA-384"},namedCurve:"P-384"};case"ES512":return{name:"ECDSA",hash:{name:"SHA-512"},namedCurve:"P-521"};case"EdDSA":return{name:"Ed25519",namedCurve:"Ed25519"};default:throw new D$($)}},S$=function($){if(N$()==="node"&&!!crypto.webcrypto)return $ instanceof crypto.webcrypto.CryptoKey;return $ instanceof CryptoKey};var n$=function($){if(typeof $==="object"&&$!==null){const O=$;return"alg"in O&&Object.values(d).includes(O.alg)&&(!("typ"in O)||O.typ==="JWT")}return!1},P$=($)=>k(j.encode(JSON.stringify($))).replace(/=/g,""),l$=($)=>k($).replace(/=/g,""),R$=($)=>JSON.parse(j$.decode(c($))),K$=async($,O,Y="HS256")=>{const Z=P$($),M=`${P$({alg:Y,typ:"JWT"})}.${Z}`,G=await A$(O,Y,j.encode(M)),W=l$(G);return`${M}.${W}`},w$=async($,O,Y="HS256")=>{const Z=$.split(".");if(Z.length!==3)throw new u($);const{header:X,payload:M}=p($);if(!n$(X))throw new _$(X);const G=Date.now()/1000|0;if(M.nbf&&M.nbf>G)throw new F$($);if(M.exp&&M.exp<=G)throw new J$($);if(M.iat&&G<M.iat)throw new E$(G,M.iat);const W=$.substring(0,$.lastIndexOf("."));if(!await H$(O,Y,c(Z[2]),j.encode(W)))throw new B$($);return M},p=($)=>{try{const[O,Y]=$.split("."),Z=R$(O),X=R$(Y);return{header:Z,payload:X}}catch{throw new u($)}};var q={sign:K$,verify:w$,decode:p};async function o$($,O){const Y=await $.formData();if(Y)return s$(Y,O);return{}}var s$=function($,O){const Y=Object.create(null);if($.forEach((Z,X)=>{if(!(O.all||X.endsWith("[]")))Y[X]=Z;else r$(Y,X,Z)}),O.dot)Object.entries(Y).forEach(([Z,X])=>{if(Z.includes("."))t$(Y,Z,X),delete Y[Z]});return Y},T$=async($,O=Object.create(null))=>{const{all:Y=!1,dot:Z=!1}=O,M=($ instanceof C?$.raw.headers:$.headers).get("Content-Type");if(M?.startsWith("multipart/form-data")||M?.startsWith("application/x-www-form-urlencoded"))return o$($,{all:Y,dot:Z});return{}},r$=($,O,Y)=>{if($[O]!==void 0)if(Array.isArray($[O]))$[O].push(Y);else $[O]=[$[O],Y];else $[O]=Y},t$=($,O,Y)=>{let Z=$;const X=O.split(".");X.forEach((M,G)=>{if(G===X.length-1)Z[M]=Y;else{if(!Z[M]||typeof Z[M]!=="object"||Array.isArray(Z[M])||Z[M]instanceof File)Z[M]=Object.create(null);Z=Z[M]}})};var q$=($)=>W$($,T),C=class{raw;#Q;#Y;routeIndex=0;path;bodyCache={};constructor($,O="/",Y=[[]]){this.raw=$,this.path=O,this.#Y=Y,this.#Q={}}param($){return $?this.#M($):this.#W()}#M($){const O=this.#Y[0][this.routeIndex][1][$],Y=this.#X(O);return Y?/\%/.test(Y)?q$(Y):Y:void 0}#W(){const $={},O=Object.keys(this.#Y[0][this.routeIndex][1]);for(let Y of O){const Z=this.#X(this.#Y[0][this.routeIndex][1][Y]);if(Z&&typeof Z==="string")$[Y]=/\%/.test(Z)?q$(Z):Z}return $}#X($){return this.#Y[1]?this.#Y[1][$]:$}query($){return z$(this.url,$)}queries($){return V$(this.url,$)}header($){if($)return this.raw.headers.get($.toLowerCase())??void 0;const O={};return this.raw.headers.forEach((Y,Z)=>{O[Z]=Y}),O}async parseBody($){return this.bodyCache.parsedBody??=await T$(this,$)}#$=($)=>{const{bodyCache:O,raw:Y}=this,Z=O[$];if(Z)return Z;const X=Object.keys(O)[0];if(X)return O[X].then((M)=>{if(X==="json")M=JSON.stringify(M);return new Response(M)[$]()});return O[$]=Y[$]()};json(){return this.#$("json")}text(){return this.#$("text")}arrayBuffer(){return this.#$("arrayBuffer")}blob(){return this.#$("blob")}formData(){return this.#$("formData")}addValidatedData($,O){this.#Q[$]=O}valid($){return this.#Q[$]}get url(){return this.raw.url}get method(){return this.raw.method}get matchedRoutes(){return this.#Y[0].map(([[,$]])=>$)}get routePath(){return this.#Y[0].map(([[,$]])=>$)[this.routeIndex].path}};var C$={Stringify:1,BeforeStream:2,Stream:3},a$=($,O)=>{const Y=new String($);return Y.isEscaped=!0,Y.callbacks=O,Y};var l=async($,O,Y,Z,X)=>{if(typeof $==="object"&&!($ instanceof String)){if(!($ instanceof Promise))$=$.toString();if($ instanceof Promise)$=await $}const M=$.callbacks;if(!M?.length)return Promise.resolve($);if(X)X[0]+=$;else X=[$];const G=Promise.all(M.map((W)=>W({phase:O,buffer:X,context:Z}))).then((W)=>Promise.all(W.filter(Boolean).map((L)=>l(L,O,!1,Z,X))).then(()=>X[0]));if(Y)return a$(await G,M);else return G};var e$="text/plain; charset=UTF-8",n=($,O={})=>{for(let Y of Object.keys(O))$.set(Y,O[Y]);return $},t0=class{#Q;#Y;env={};#M;finalized=!1;error;#W=200;#X;#$;#O;#G;#L=!0;#N;#z;#V;#D;#F;constructor($,O){if(this.#Q=$,O)this.#X=O.executionCtx,this.env=O.env,this.#V=O.notFoundHandler,this.#F=O.path,this.#D=O.matchResult}get req(){return this.#Y??=new C(this.#Q,this.#F,this.#D),this.#Y}get event(){if(this.#X&&"respondWith"in this.#X)return this.#X;else throw Error("This context has no FetchEvent")}get executionCtx(){if(this.#X)return this.#X;else throw Error("This context has no ExecutionContext")}get res(){return this.#L=!1,this.#G||=new Response("404 Not Found",{status:404})}set res($){if(this.#L=!1,this.#G&&$)try{for(let[O,Y]of this.#G.headers.entries()){if(O==="content-type")continue;if(O==="set-cookie"){const Z=this.#G.headers.getSetCookie();$.headers.delete("set-cookie");for(let X of Z)$.headers.append("set-cookie",X)}else $.headers.set(O,Y)}}catch(O){if(O instanceof TypeError&&O.message.includes("immutable")){this.res=new Response($.body,{headers:$.headers,status:$.status});return}else throw O}this.#G=$,this.finalized=!0}render=(...$)=>{return this.#z??=(O)=>this.html(O),this.#z(...$)};setLayout=($)=>this.#N=$;getLayout=()=>this.#N;setRenderer=($)=>{this.#z=$};header=($,O,Y)=>{if(O===void 0){if(this.#$)this.#$.delete($);else if(this.#O)delete this.#O[$.toLocaleLowerCase()];if(this.finalized)this.res.headers.delete($);return}if(Y?.append){if(!this.#$)this.#L=!1,this.#$=new Headers(this.#O),this.#O={};this.#$.append($,O)}else if(this.#$)this.#$.set($,O);else this.#O??={},this.#O[$.toLowerCase()]=O;if(this.finalized)if(Y?.append)this.res.headers.append($,O);else this.res.headers.set($,O)};status=($)=>{this.#L=!1,this.#W=$};set=($,O)=>{this.#M??=new Map,this.#M.set($,O)};get=($)=>{return this.#M?this.#M.get($):void 0};get var(){if(!this.#M)return{};return Object.fromEntries(this.#M)}#Z($,O,Y){if(this.#L&&!Y&&!O&&this.#W===200)return new Response($,{headers:this.#O});if(O&&typeof O!=="number"){const X=new Headers(O.headers);if(this.#$)this.#$.forEach((G,W)=>{if(W==="set-cookie")X.append(W,G);else X.set(W,G)});const M=n(X,this.#O);return new Response($,{headers:M,status:O.status??this.#W})}const Z=typeof O==="number"?O:this.#W;if(this.#O??={},this.#$??=new Headers,n(this.#$,this.#O),this.#G)this.#G.headers.forEach((X,M)=>{if(M==="set-cookie")this.#$?.append(M,X);else this.#$?.set(M,X)}),n(this.#$,this.#O);Y??={};for(let[X,M]of Object.entries(Y))if(typeof M==="string")this.#$.set(X,M);else{this.#$.delete(X);for(let G of M)this.#$.append(X,G)}return new Response($,{status:Z,headers:this.#$})}newResponse=(...$)=>this.#Z(...$);body=($,O,Y)=>{return typeof O==="number"?this.#Z($,O,Y):this.#Z($,O)};text=($,O,Y)=>{if(!this.#O){if(this.#L&&!Y&&!O)return new Response($);this.#O={}}if(this.#O["content-type"]=e$,typeof O==="number")return this.#Z($,O,Y);return this.#Z($,O)};json=($,O,Y)=>{const Z=JSON.stringify($);return this.#O??={},this.#O["content-type"]="application/json",typeof O==="number"?this.#Z(Z,O,Y):this.#Z(Z,O)};html=($,O,Y)=>{if(this.#O??={},this.#O["content-type"]="text/html; charset=UTF-8",typeof $==="object")return l($,C$.Stringify,!1,{}).then((Z)=>{return typeof O==="number"?this.#Z(Z,O,Y):this.#Z(Z,O)});return typeof O==="number"?this.#Z($,O,Y):this.#Z($,O)};redirect=($,O)=>{return this.#$??=new Headers,this.#$.set("Location",String($)),this.newResponse(null,O??302)};notFound=()=>{return this.#V??=()=>new Response,this.#V(this)}};var $0=q.verify,O0=q.decode,o=q.sign;var Y0="rush64counter648hua26gxitrocks";async function s({ag:$,an:O,aid:Y="xxxxx",pl:Z=0,reg:X="enam"}){const M=crypto.randomUUID(),G={sid:M,ag:$,an:O,aid:Y,pl:Z,reg:X,exp:Math.floor(Date.now()/1000)+28800};return{sessionToken:await o(G,Y0),sid:M}}async function r({ag:$,an:O,aid:Y,account:Z,reg:X,pl:M,color:G,lang:W="en",version:L,b64:z,startBlock:e}){const{sessionToken:$$,sid:U}=await s({ag:$,an:O,aid:Y,account:Z,reg:X,pl:M,color:G});return`

<!DOCTYPE html>
<html lang="${W}">

<head>
    <meta charset="UTF-8">
    <title>@${$}/${O}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="a rhappsody app">
    <meta name="rh-sid" content="${U}">
    <meta name="rh-aid" content="${Y}">
    <meta name="rh-account" content="${Z}">
    <!-- Preload critical resources -->
    <link rel="preload" href="https://test.rh.local/core-rhapp/dist/rhapp.js" as="script">
    <link rel="preload" href="https://r.rhap.cc/latest/rh.css" as="style">
    <link rel="preload" href="https://public-enam.rhappsody.cloud/7f8c37cb-118b-44f7-814c-0332b392808f/08d97c15-6f06-420b-976f-2418bd9caa60/rhapp.bin" as="fetch" crossorigin>
    <link rel="icon" type="image/x-icon" href="/rh.ico">
    <!-- <link rel="manifest" href="${O}/manifest"> -->
    <!-- CSS should load first (render-blocking) -->
    <link rel="stylesheet" href="https://r.rhap.cc/latest/rh.css">
    <!-- JS library with async loading -->
    <script async src="https://test.rh.local/core-rhapp/dist/rhapp.js"></script>
    <!-- <script async src="/fn/ag-visit?sid=${U}&an=${O}"></script> -->
    <!-- Your app initialization script -->
    <script>
      // Wait for both library and binary to be ready
      async function initApp() {
        // Fetch binary file
        const R = await fetch('https://public-enam.rhappsody.cloud/7f8c37cb-118b-44f7-814c-0332b392808f/08d97c15-6f06-420b-976f-2418bd9caa60/rhapp.bin');
        const ab = await R.arrayBuffer();
        const rhcbin = new Uint8Array(ab);
        // Wait for library to be available
        while (typeof Rhapp === 'undefined') {
          await new Promise(resolve => setTimeout(resolve, 10));
        }
        window.app = new Rhapp(document.body);
        window.app.vm.boot(rhcbin);
      }
      // Start initialization when DOM is ready
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initApp);
      } else {
        initApp();
      }
    </script>
  </head>
<body class="light" data-rh-session-token="${$$}"></body>
</html>
  `}function t($){return`
  <!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://r.rhap.cc/latest/rh.css?latest" rel="stylesheet">
    <script src="/static/is.js"></script>
    <title>App Not Live</title>
</head>

<body class="light primary">
    <template id="rh-ctx-url">
        <header class="primary">
            <h6 class="center-align"><rh-span>@AG/AN</rh-span></h6>
        </header>
        <div class="fixed center middle center-align">
            <rh-icon-bare name="mdi:calendar-clock" size="8rem"></rh-icon-bare>
            <h6><rh-span>App is Not Live Yet!</rh-span></h6>
            <p class="">It will be available on</p>
            <h6 class="bold" id="livein-date"></h6>
            <div class="space"></div>
            <div>
                <p class="no-line small-text">Please check back later.If you have questions, please
                    contact the
                    app owner.</p>
            </div>
        </div>
        <rh-copyright size="small"></rh-copyright>
        <script>
            const htmlElement = document.documentElement;
            const lang = htmlElement.getAttribute('lang');
            console.log('HTML lang attribute:', lang);
            const t = "${$}";
            console.log(t);
            const date = new Date(Number(t));
            const formattedDate = date.toLocaleString(lang, {
                weekday: 'long',
                month: 'long',
                day: 'numeric',
                year: 'numeric',
                hour: 'numeric',
                minute: 'numeric',
            });
            console.log(formattedDate);
            document.getElementById("livein-date").innerHTML = formattedDate;
        </script>
    </template>
    <rh-ctx-url></rh-ctx-url>
</body>

</html>
  `}function a({ag:$,an:O,color:Y}){return{name:`${$} ${O}`,short_name:`${$} ${O}`,description:`${$} ${O} page`,lang:"en",orientation:"portrait",display:"standalone",background_color:`#${Y}`,theme_color:`#${Y}`,start_url:`/${O}`,features:["powered by Rhappsody"],icons:[{src:`https://${$}.rhapp.app/${O}/icon`,sizes:"512x512",type:"image/png"}]}}var S="rush64counter648hua26gxitrocks",Z0="https://sb.rhap.cc/storage/v1/object/public/apps",X0="https://ctx.rhap.cc";var H2={async fetch($){const O=new URL($.url),Y=O.hostname.split(".")[0],[,Z,X,M,G]=O.pathname.split("/");if(Z==="cf-fonts")return fetch($);if(Z==="_"){const Q=O.pathname.replace("/_/","");return fetch(`https://rh.rhap.cc/${Q}`)}if(Z==="_op"){const Q=O.pathname.replace("/_op/","");return fetch(`https://op.rhap.cc/${Q}`)}if(Z==="_doc"){const Q=O.pathname.replace("/_doc/","");return fetch(`https://doc.rhap.cc/${Q}`)}if(O.pathname.endsWith("/manifest"))return new Response(JSON.stringify(a({ag:Y,an:Z,name:Z,color:"blue"})),{headers:{"Content-Type":"application/json"}});if(Z==="_img")return await fetch(`https://sb.rhap.cc/storage/v1/object/public/apps/${Y}/_img/${X}/${M?M:"orig"}.png`);if(Z==="_assets")return await fetch(`https://sb.rhap.cc/storage/v1/object/public/apps/_system/${X}/${M}`);if(Z==="rh.ico")return fetch("https://sb.rhap.cc/storage/v1/object/public/apps/_system/ico/blue.ico");if(Z==="sw.js")return fetch("https://app-sidecar.rhappsody.cloud/sw.js");if(Z==="_rhapp.js")return fetch(`${Z0}/${Y}/_rhapp.js`);if(Z==="_ai"){const Q=O.pathname.split("/");Q.shift(),Q.shift();const V=Q.join("/");return fetch(`https://ai.rhap.cc/${V}`)}if(["account","apps","auth","claim","create","dashboard","groups","images","users","new","signup","used","visits"].includes(Z)){const Q=X?`${X}.html`:"index.html";return fetch(`https://app-sidecar.rhappsody.cloud/${Z}/${Q}`)}if(Z==="fn"){const Q=new URL(`https://cfn-${X}.xpes.workers.dev`);for(let[_,H]of O.searchParams)Q.searchParams.set(_,H);Q.searchParams.set("ag",Y),Q.searchParams.set("shared_secret",S);let V=null;if($.body)V=$.clone().body;const J=new Request(Q,{method:$.method,headers:$.headers,body:$.body});return fetch(J)}if(Z==="rha"){const Q=new URL(`https://rha-${X}.xpes.workers.dev`);for(let[_,H]of O.searchParams)Q.searchParams.set(_,H);Q.searchParams.set("ag",Y),Q.searchParams.set("shared_secret",S);let V=null;if($.body)V=$.clone().body;const J=new Request(Q,{method:$.method,headers:$.headers,body:V});return fetch(J)}const L=O.searchParams.has("latest")?`?latest&ts=${Date.now()}`:"",z=O.searchParams.has("preview"),e=O.searchParams.has("oldversion"),$$=z?"preview.rhbin":e?"previous.rhbin":"app.rhbin",U=await fetch(`${X0}/${Y}/${Z}/app.ctx`);if(!U.ok)return new Response(`app! @${Y}/${Z} not found here....`,{status:404});const O$=await U.text(),F=U.headers.get("Content-Type"),[x$,M0,A,E,f$,b$,Y$,Z$,v$]=F.split("/"),[x,K,X$,f,w,h$,P]=f$.split("-");let M$="start";if(X)switch(X){case"_ctx":return new Response(JSON.stringify({account:A,aid:E,brand:b$,color:Y$,lang:Z$,name:v$,sysStatus:x,status:K,version:X$,pl:f,reg:w,exp:h$,nbf:P}),{headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, PUT, DELETE, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization, X-Client-ID,rh-tag"}});case"icon":const Q=`https://sb.rhap.cc/storage/v1/object/public/apps/${A}/${E}/app-icon.png`;return fetch(Q);case"banner":const V=`https://sb.rhap.cc/storage/v1/object/public/apps/${A}/${E}/banner.png`;return fetch(V);case"social":const J=`https://sb.rhap.cc/storage/v1/object/public/apps/${A}/${E}/social.png`;return fetch(J);case"rhapp.js":const _=`https://pub-${w}.rhap.cc/${A}/${E}/app.js`,H=await fetch(_),g$={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, PUT, DELETE, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization"};return new Response(H.body,{headers:{...g$,...H.headers}});case"rha":try{let B=`https://rha-${M}.xpes.workers.dev?ag=${Y}&an=${Z}&shared_secret=${S}&rh_ctx=${F}`,R=null;if($.body)R=$.clone().body;const m=new Request(B,{method:$.method,headers:$.headers,body:R}),N=await fetch(m),D=new Headers(N.headers);if(D.set("Access-Control-Allow-Origin","*"),D.set("Access-Control-Allow-Methods","GET, POST, PUT, DELETE, OPTIONS"),D.set("Access-Control-Allow-Headers","Content-Type, Authorization, X-Client-ID,rh-tag"),!N.ok)throw new Error(`Snippet HTTP error status: ${N.status}`);return new Response(N.body,{status:N.status,statusText:N.statusText,headers:D})}catch(B){return new Response(`Error in snippet: ${B.message}`,{status:555})}break;case"fn":try{let B=`https://cfn-${M}.xpes.workers.dev?ag=${Y}&an=${Z}&shared_secret=${S}&rh_ctx=${F}`,R=null;if($.body)R=$.clone().body;const m=new Request(B,{method:$.method,headers:$.headers,body:R}),N=await fetch(m),D=new Headers(N.headers);if(D.set("Access-Control-Allow-Origin","*"),D.set("Access-Control-Allow-Methods","GET, POST, PUT, DELETE, OPTIONS"),D.set("Access-Control-Allow-Headers","Content-Type, Authorization"),!N.ok)throw new Error(`Snippet HTTP error status: ${N.status}`);return new Response(N.body,{status:N.status,statusText:N.statusText,headers:D})}catch(B){return new Response(`Error in snippet: ${B.message}`,{status:555})}break;case"go":M$=M;break;case"manifest":break;case"icon":return fetch(`https://sb.rhap.cc/storage/v1/object/public/apps/${Y}/${Z}/app-icon.png`);case"as":const G$=O.searchParams.get("pw"),Q$=O.searchParams.get("role");let b=`${G?`https://serve-app-as.xpes.workers.dev/${M}/${G}`:`https://serve-app-as.xpes.workers.dev/${M}`}?ag=${Y}&an=${Z}&shared_secret=${S}`;if(G$)b+=`&pw=${G$}`;if(Q$)b+=`&role=${Q$}`;return fetch(b,{method:$.method});case"img":return fetch(`https://pub-${w}.rhappsody.cloud/${A}/${E}/images/${M}.png`);case"is":case"app":case"source":case"data":case"edit":case"images":case"assets":case"overview":case"users":case"share":case"install":case"info":case"profile":case"admin":case"login":case"inbox":case"splash":case"plugins":case"publish":case"contact":case"_dev":case"help":case"ask":case"chat":case"blog":case"files":case"attachments":const c$=M?`${M}.html`:"index.html",v=await fetch(`https://app-sidecar.rhappsody.cloud/${X}/${c$}`),h=new Headers(v.headers);return h.set("Server-Timing",`rhctx;desc="${F}"`),h.set("rh-ctx",F),new Response(v.body,{status:v.status,headers:h});default:return fetch($)}if(x!=="0")return new Response(`sysStatus = ${x}`);if(K==="1")return new Response(`inactive status = ${K}`);if(z){if(Number(f)<10)return fetch("https://app-sidecar.rhappsody.cloud/preview/notsupported.html");const Q=await fetch("https://app-sidecar.rhappsody.cloud/preview/index.html"),V=new Headers(Q.headers);return V.set("Server-Timing",`rhctx;desc="${F}"`),V.set("rh-ctx",F),new Response(Q.body,{status:Q.status,headers:V})}if(!z){const Q=Date.now();if(P!=="0"&&P!=="null"){if(Q<Number(P))return new Response(t(P),{headers:{"content-type":"text/html;charset=UTF-8"}})}}if(K==="1"){const Q=O.searchParams.get("pw");let J=`https://serve-app-as.xpes.workers.dev/protected?ag=${Y}&an=${Z}&shared_secret=${S}`;if(Q)J+=`&pw=${Q}`;return fetch(J,{method:$.method})}const m$=await r({ag:Y,an:Z,aid:E,reg:w,pl:f,color:Y$,lang:Z$,b64:O$,startBlock:M$,version:X$});return new Response(m$,{headers:{"Content-Type":"text/html; charset=utf-8"}})}};export{H2 as default};
